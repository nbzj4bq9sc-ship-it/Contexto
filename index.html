<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Contexto FR</title>

<style>
body {
  background:#121212;
  color:#fff;
  font-family:system-ui;
  margin:0;
  padding:16px;
}

.app {
  max-width:480px;
  margin:auto;
  display:flex;
  flex-direction:column;
  gap:12px;
}

h1 {
  text-align:center;
  margin-bottom:4px;
}

input, button {
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:10px;
  border:none;
}

input {
  background:#1e1e1e;
  color:#fff;
}

button {
  background:#f5f5f0; /* Valider â†’ blanc/crÃ¨me neutre */
  color:#000;
  font-weight:bold;
  cursor:pointer;
}

button.secondary {
  background:#1e88e5;
  color:#fff;
}

button:disabled {
  opacity:.5;
  cursor:not-allowed;
}

.message {
  text-align:center;
  font-size:14px;
  opacity:.85;
}

ul {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:8px;
}

li {
  background:#1e1e1e;
  padding:12px;
  border-radius:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:500;
}

/* couleurs contextuelles */
.good { background:#1b5e20; }   /* mot du jour â†’ vert foncÃ© */
.near { background: linear-gradient(90deg, #3fae7f, #3f83ae); color:#fff; }   /* proche â†’ dÃ©gradÃ© vertâ†’bleu */
.medium { background:#f9a825; } /* moyen â†’ jaune */
.bad { background:#8e0000; }    /* loin â†’ rouge */

.score {
  opacity:.9;
  font-size:14px;
}
</style>
</head>

<body>
<div class="app">
  <h1>Contexto ðŸ‡«ðŸ‡·</h1>

  <input id="guess" placeholder="Entrez un motâ€¦" />
  <button id="submit">Valider</button>

  <div id="info" class="message"></div>

  <ul id="results"></ul>

  <button id="share" class="secondary" style="display:none;">
    ðŸŽ‰ Partager mon rÃ©sultat
  </button>
</div>

<script>
// ---------------- DONNÃ‰ES ----------------
const semanticGroups = {
  emotions: ["amour","haine","joie","tristesse","peur","colÃ¨re"],
  nature: ["arbre","forÃªt","pluie","soleil","vent","mer"],
  human: ["homme","femme","enfant","personne","gens"],
  city: ["ville","route","immeuble","voiture","bruit"],
  mind: ["pensÃ©e","idÃ©e","esprit","cerveau","mÃ©moire"]
};

// ---------------- MOT DU JOUR ----------------
const today = new Date().toISOString().slice(0,10);
const secretWords = Object.values(semanticGroups).flat();
const secret = secretWords[
  today.split("-").join("") % secretWords.length
];

// ---------------- STORAGE ----------------
const STORAGE_KEY = "contexto_fr_" + today;
const PLAYED_KEY = "contexto_fr_played_" + today;

let guesses = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let played = localStorage.getItem(PLAYED_KEY) === "true";
let found = guesses.some(g => g.rank === 1);

// ---------------- LOGIQUE ----------------
function getGroup(word) {
  for (let g in semanticGroups) {
    if (semanticGroups[g].includes(word)) return g;
  }
  return null;
}

function similarityRank(word) {
  if (word === secret) return 1;

  const g1 = getGroup(word);
  const g2 = getGroup(secret);

  if (!g1 || !g2) {
    return 1001 + Math.floor(Math.random() * 1500);
  }

  if (g1 === g2) {
    return 2 + Math.floor(Math.random() * 498);
  }

  return 500 + Math.floor(Math.random() * 500);
}

function colorClass(rank) {
  if (rank === 1) return "good";       // mot du jour â†’ vert foncÃ©
  if (rank >= 2 && rank <= 500) return "near"; // proche â†’ dÃ©gradÃ© vertâ†’bleu
  if (rank <= 1000) return "medium";   // moyen â†’ jaune
  return "bad";                        // loin â†’ rouge
}

// ---------------- INTERACTIONS ----------------
const input = document.getElementById("guess");
const button = document.getElementById("submit");
const info = document.getElementById("info");
const shareBtn = document.getElementById("share");

if (played && !found) {
  input.disabled = true;
  button.disabled = true;
  info.textContent =
    "ðŸ˜Ž Tu as dÃ©jÃ  jouÃ© aujourdâ€™hui. Partage Ã  tes amis et reviens demain !";
}

button.onclick = () => {
  if (played || found) return;

  const word = input.value.toLowerCase().trim();
  if (!word) return;
  if (guesses.some(g => g.word === word)) return;

  const rank = similarityRank(word);
  guesses.push({ word, rank });
  guesses.sort((a,b) => a.rank - b.rank);

  if (rank === 1) {
    found = true;
    played = true;
    localStorage.setItem(PLAYED_KEY, "true");
    info.textContent = "ðŸŽ‰ Bravo ! Tu as trouvÃ© le mot du jour.";
    input.disabled = true;
    button.disabled = true;
    shareBtn.style.display = "block";
  }

  localStorage.setItem(STORAGE_KEY, JSON.stringify(guesses));
  input.value = "";
  render();
};

// ---------------- PARTAGE ----------------
shareBtn.onclick = () => {
  const tries = guesses.length;
  const text = `ðŸŽ‰ Jâ€™ai trouvÃ© le mot mystÃ¨re du jour en ${tries} essais, Ã  toi maintenant !`;

  if (navigator.share) {
    navigator.share({ text });
  } else {
    navigator.clipboard.writeText(text);
    alert("RÃ©sultat copiÃ© dans le presse-papiers ðŸ“‹");
  }
};

// ---------------- RENDER ----------------
function render() {
  const ul = document.getElementById("results");
  ul.innerHTML = "";

  guesses.forEach(g => {
    const li = document.createElement("li");
    li.className = colorClass(g.rank);
    li.innerHTML = `
      <span>${g.word}</span>
      <span class="score">${g.rank}</span>
    `;
    ul.appendChild(li);
  });
}

render();
</script>
</body>
</html>
